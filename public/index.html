<!DOCTYPE html>
<html>

<head>
  <meta charset='utf-8'>
  <link rel='stylesheet' href='style.css'>
  <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.10/lodash.min.js"></script>
  <script src='marker.js'></script>
</head>

<body>
  <script>
    // Grab initial data from localStorage
    let list = localStorage.getItem('list') || "[]"
    list = JSON.parse(list)

    const selected = list && list.length > 0
      ? list[0]
      : ''
    const content = list && list.length > 0
      ? localStorage.getItem(list[0])
      : ''

    // Init Elm App
    var app = Elm.Marker.init({
      node: document.querySelector('body'),
      flags: { list, selected, content }
    })

    // Save Content
    const onSave = ([selected, content]) => {
      console.log('saving...', selected)
      localStorage.setItem(selected, content)
    }

    // Debounce in Elm seems like a PitA atm, do it in js
    const onAutoSave = _.debounce(onSave, 500)

    // Subscribe to Elm ports
    app.ports.save.subscribe(onSave)

    app.ports.autosave.subscribe(onAutoSave)

    app.ports.select.subscribe((item) => {
      const content = localStorage.getItem(item) || ''
      app.ports.loadContent.send(content)
    })
  </script>
</body>

</html>
